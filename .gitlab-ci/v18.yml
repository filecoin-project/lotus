"v18: build lotus":
  extends: .build-snippet
  artifacts:
    name: "v18 binaries"
    paths: [lotus, lotus-miner, lotus-worker]
  script:
    - make lotus lotus-miner lotus-worker
  only:
    refs:
      - v18

"v18: build external binaries":
  extends: .build-snippet
  artifacts:
    name: "v18 external binaries"
    paths: [lotus-shed, lotus-wallet, lotus-gateway, lotus-stats]
  script:
    - make lotus-shed lotus-wallet lotus-gateway lotus-stats
  only:
    refs:
      - v18
  when: manual

"v18: build lotus (2k)":
  extends: .build-snippet
  variables:
    GOFLAGS: "-tags=2k"
  artifacts:
    name: "v18-2k binaries"
    paths: [lotus-shed, lotus, lotus-miner, lotus-worker, lotus-seed]
  script:
    - make lotus-shed lotus lotus-miner lotus-worker lotus-seed
  only:
    refs:
      - v18
  when: manual

"v18: build docker (2k)":
  image: geektr/yumemi:builder-20221213
  tags: [docker, x86, merak]
  stage: build
  dependencies: ["v18: build lotus (2k)"]
  variables:
    # DOCKER_BUILDKIT: 1
    docker_file: .gitlabci/Dockerfile.debian
    docker_tag: "@repo/v18:debian-2k-@datetime"
  script:
    - yumemi gitlab-ci docker build
  only:
    refs:
      - v18

"v18: build external binaries (2k)":
  extends: .build-snippet
  variables:
    GOFLAGS: "-tags=2k"
  artifacts:
    name: "v18-2k external binaries"
    paths: [lotus-wallet, lotus-gateway, lotus-stats]
  script:
    - make lotus-wallet lotus-gateway lotus-stats
  only:
    refs:
      - v18
  when: manual
